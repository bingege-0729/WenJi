<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.Mapper.RegionMapper">
    <select id="selectByCode" resultType="com.example.Pojo.Region">
        SELECT
            region_code,
            parent_code,
            name,
            level,
            center_lat,
            center_lng,
            polygon,
            sort_order,
            is_active,
            create_time,
            update_time
        FROM regions
        WHERE region_code = #{regionCode}
          AND is_active = TRUE
    </select>
    <select id="getCityByLocation" resultType="com.example.Pojo.Region">
        SELECT * FROM regions
        WHERE level = 2
          AND is_active = TRUE
          AND ST_Contains(ST_GeomFromText(polygon), ST_PointFromText(CONCAT('POINT(', #{lng}, ' ', #{lat}, ')')))
        LIMIT 1
    </select>

</mapper>